#!/usr/bin/env bash
set -e

echo "ğŸ” Running code quality checks..."
echo ""

# Function to print section headers
print_section() {
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo "ğŸ“‹ $1"
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
}

# Track overall success
OVERALL_SUCCESS=true

# Run RuboCop
print_section "RUBOCOP - Code Style & Linting"
if bundle exec rubocop; then
    echo "âœ… RuboCop passed"
else
    echo "âŒ RuboCop failed"
    OVERALL_SUCCESS=false
fi
echo ""

# Run RSpec
print_section "RSPEC - Tests"
if bundle exec rspec; then
    echo "âœ… RSpec passed"
else
    echo "âŒ RSpec failed"
    OVERALL_SUCCESS=false
fi
echo ""

# Run README examples test
print_section "README EXAMPLES - Documentation Tests"
if bin/test_readme_examples; then
    echo "âœ… README examples passed"
else
    echo "âŒ README examples failed"
    OVERALL_SUCCESS=false
fi
echo ""

# Final summary
print_section "SUMMARY"
if $OVERALL_SUCCESS; then
    echo "ğŸ‰ All checks passed!"
    exit 0
else
    echo "ğŸ’¥ Some checks failed. Please review the output above."
    exit 1
fi
